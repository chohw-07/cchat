<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cchat - 서버 없는 P2P 채팅</title>
    <meta name="description" content="WebRTC 기반 P2P 채팅 애플리케이션. 서버 없이 브라우저 간 직접 통신합니다.">
    <link rel="stylesheet" href="styles.css">
    <!-- favicon 경로 수정 -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
    <!-- 필수 진입 모달 -->
    <div class="modal-overlay" id="entryModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2>cchat에 오신 것을 환영합니다</h2>
            </div>
            <div class="modal-content">
                <div class="setup-option">
                    <h3>1. 새 방 만들기</h3>
                    <button id="createRoomModalBtn" class="primary-button">방 만들기</button>
                </div>
                <div class="setup-option">
                    <h3>2. 방 참여하기</h3>
                    <div class="join-form">
                        <input type="text" id="joinCodeModalInput" placeholder="초대 코드 입력">
                        <button id="joinRoomModalBtn" class="primary-button">참여하기</button>
                    </div>
                </div>
                <div class="name-setup">
                    <h3>사용자 이름 설정</h3>
                    <input type="text" id="userNameModalInput" placeholder="사용자 이름 입력">
                </div>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- 채널 목록 -->
        <div class="channels-panel">
            <div class="app-logo">cchat</div>
            <div class="channels-header">
                <span>채널</span>
                <span id="addChannelIcon" class="add-icon" title="채널 추가">+</span>
            </div>
            <div class="channels-list" id="channelsList">
                <div class="channel active" data-channel="general">일반</div>
            </div>
            <div class="user-info" id="userInfo">
                <div class="user-avatar" id="userAvatar"></div>
                <div class="user-name" id="userName">사용자</div>
                <div class="user-menu-icon">⚙️</div>
            </div>
        </div>

        <!-- 중앙: 메인 콘텐츠 영역 -->
        <div class="main-content">
            <!-- 채팅 화면 -->
            <div id="chatScreen" class="chat-screen">
                <div class="chat-header">
                    <h2 id="roomName">채팅방</h2>
                    <div class="connection-status" id="connectionStatus">연결 중...</div>
                    <button id="inviteBtn" class="invite-button">초대하기</button>
                </div>
                <div class="chat-messages" id="chatMessages"></div>
                <div class="typing-indicator hidden" id="typingIndicator"></div>
                <div class="chat-input-area">
                    <div class="file-upload">
                        <label for="fileInput" class="file-upload-btn" title="파일 보내기">+</label>
                        <input type="file" id="fileInput" class="hidden">
                    </div>
                    <input type="text" id="messageInput" placeholder="메시지 입력...">
                    <button id="sendMessageBtn">전송</button>
                </div>
            </div>
        </div>

        <!-- 우측: 사용자 목록 -->
        <div class="users-panel" id="usersPanel">
            <div class="users-header">접속 중인 사용자</div>
            <div class="users-list" id="usersList"></div>
        </div>
    </div>

    <!-- 초대 모달 -->
    <div class="modal-overlay hidden" id="inviteModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2>친구 초대하기</h2>
                <span class="close-modal" id="closeInviteModal">&times;</span>
            </div>
            <div class="modal-content">
                <div class="invite-info">
                    <h3>초대 코드</h3>
                    <div class="invite-code" id="inviteCode"></div>
                    <button id="copyInviteBtn" class="secondary-button">코드 복사</button>
                </div>
                <div class="invite-info">
                    <h3>초대 링크</h3>
                    <div class="invite-code" id="inviteLink"></div>
                    <button id="copyLinkBtn" class="secondary-button">링크 복사</button>
                </div>
                <div class="qr-container" id="qrContainer"></div>
            </div>
        </div>
    </div>

    <!-- 연결 모달 -->
    <div class="modal-overlay hidden" id="connectionModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2>연결 중...</h2>
            </div>
            <div class="modal-content">
                <div class="connection-steps">
                    <div class="connection-step" id="step1">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-title">연결 정보 교환 중</div>
                            <div class="step-progress"><div class="loader"></div></div>
                        </div>
                    </div>
                    <div class="connection-step" id="step2">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="step-title">P2P 연결 설정 중</div>
                            <div class="step-progress"><div class="loader"></div></div>
                        </div>
                    </div>
                    <div class="connection-step" id="step3">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-title">데이터 채널 설정 중</div>
                            <div class="step-progress"><div class="loader"></div></div>
                        </div>
                    </div>
                </div>
                <div class="connection-error hidden" id="connectionError">
                    <div class="error-icon">❌</div>
                    <div class="error-message">연결 중 오류가 발생했습니다.</div>
                    <button id="retryConnectionBtn" class="primary-button">다시 시도</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 프로필 모달 -->
    <div class="modal-overlay hidden" id="profileModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2>프로필 설정</h2>
                <span class="close-modal" id="closeProfileModal">&times;</span>
            </div>
            <div class="modal-content">
                <div class="profile-section">
                    <div class="avatar-selector">
                        <div class="current-avatar" id="currentAvatar"></div>
                        <button id="changeAvatarBtn" class="secondary-button">이미지 변경</button>
                        <input type="file" id="avatarInput" accept="image/*" class="hidden">
                    </div>
                    <div class="profile-name">
                        <label for="profileNameInput">이름</label>
                        <input type="text" id="profileNameInput" placeholder="사용자 이름 입력">
                    </div>
                    <div class="status-selector">
                        <label for="statusSelector">상태:</label>
                        <select id="statusSelector">
                            <option value="online">온라인</option>
                            <option value="away">자리 비움</option>
                            <option value="dnd">방해 금지</option>
                        </select>
                    </div>
                </div>
                <div class="notification-settings">
                    <h3>알림 설정</h3>
                    <div class="setting-row">
                        <label for="notificationToggle">데스크톱 알림</label>
                        <label class="switch">
                            <input type="checkbox" id="notificationToggle" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <label for="soundToggle">알림 소리</label>
                        <label class="switch">
                            <input type="checkbox" id="soundToggle" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="notification-permission-info hidden" id="notificationPermissionInfo">
                        <p>알림 권한이 필요합니다. 브라우저 설정에서 권한을 허용해주세요.</p>
                        <button id="requestPermissionBtn" class="secondary-button">권한 요청</button>
                    </div>
                </div>
                <div class="theme-settings">
                    <h3>테마 설정</h3>
                    <div class="setting-row">
                        <label for="themeToggle">밝은 테마</label>
                        <label class="switch">
                            <input type="checkbox" id="themeToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
                <button id="saveProfileBtn" class="primary-button">저장</button>
            </div>
        </div>
    </div>
    
    <!-- 관리자 모달 -->
    <div class="modal-overlay hidden" id="adminModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2>관리자 메뉴</h2>
                <span class="close-modal" id="closeAdminModal">&times;</span>
            </div>
            <div class="modal-content">
                <div class="admin-section">
                    <h3>사용자 관리</h3>
                    <div class="admin-user-list" id="adminUserList">
                        <!-- 사용자 목록이 여기에 동적으로 표시됨 -->
                    </div>
                </div>
                <div class="admin-section">
                    <h3>채널 관리</h3>
                    <div class="admin-channel-list" id="adminChannelList">
                        <!-- 채널 목록이 여기에 동적으로 표시됨 -->
                    </div>
                    <div class="add-channel">
                        <input type="text" id="newChannelInput" placeholder="새 채널 이름">
                        <button id="addChannelBtn" class="secondary-button">채널 추가</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 사용자 관리 모달 -->
    <div class="modal-overlay hidden" id="userManageModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="managedUserName">사용자 관리</h2>
                <span class="close-modal" id="closeUserManageModal">&times;</span>
            </div>
            <div class="modal-content">
                <div class="user-manage-options">
                    <button id="giveAdminBtn" class="admin-action-btn">관리자 권한 부여</button>
                    <button id="removeAdminBtn" class="admin-action-btn">관리자 권한 제거</button>
                    <button id="timeoutUserBtn" class="admin-action-btn">타임아웃 (5분)</button>
                    <button id="kickUserBtn" class="admin-action-btn warning">강퇴</button>
                    <button id="banUserBtn" class="admin-action-btn danger">차단</button>
                </div>
                <div id="userManageInfo" class="user-manage-info"></div>
            </div>
        </div>
    </div>

    <!-- 정보창 모달 -->
    <div class="modal-overlay hidden" id="infoModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2>cchat 정보</h2>
                <span class="close-modal" id="closeInfoModal">&times;</span>
            </div>
            <div class="modal-content">
                <div class="info-section">
                    <h3>cchat 버전 1.2.0</h3>
                    <p>서버 없이 브라우저 간 직접 통신하는 P2P 채팅 애플리케이션입니다.</p>
                    <p>WebRTC 기술을 활용하여 중앙 서버 없이도 실시간 통신이 가능합니다.</p>
                    <h4>주요 기능</h4>
                    <ul>
                        <li>실시간 텍스트 채팅</li>
                        <li>파일 전송</li>
                        <li>다중 채널 지원</li>
                        <li>사용자 관리 (관리자, 타임아웃, 차단)</li>
                        <li>개인 프로필 설정</li>
                        <li>알림 및 상태 표시</li>
                    </ul>
                    <p class="info-footer">Made with ❤️ by cchat team, 2023</p>
                </div>
            </div>
        </div>
    </div>

    <!-- QR 코드 생성용 라이브러리 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- 심플한 P2P 라이브러리 (PeerJS) - 최신 버전으로 업데이트 -->
    <script src="https://unpkg.com/peerjs@1.5.1/dist/peerjs.min.js"></script>
    <!-- 메인 스크립트 -->
    <script src="app.js"></script>
</body>
</html>
